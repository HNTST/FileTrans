<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | –û–±–º–µ–Ω–Ω–∏–∫ —Ñ–∞–π–ª–æ–≤</title>
  <!-- Bootstrap CSS -->
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
          rel="stylesheet"
  />
  <!-- Font Awesome –∏–∫–æ–Ω–∫–∏ -->
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          rel="stylesheet"
  />
  <!-- Animate.css –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
          rel="stylesheet"
  />
  <style>
    :root {
      /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
      --primary-color: #343a40;
      --secondary-color: #212529;
      --success-color: #5a6268;
      --danger-color: #6c757d;
      --warning-color: #5a6268;
      --info-color: #495057;
    }

    body {
      background: linear-gradient(
              135deg,
              rgba(52, 58, 64, 0.1) 0%,
              rgba(33, 37, 41, 0.1) 100%
      );
      min-height: 100vh;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--dark-color);
      padding-bottom: 50px;
    }

    .sticky-wrapper {
      position: sticky;
      top: 20px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –≤–µ—Ä—Ö–∞ */
      align-self: flex-start;
      z-index: 100;
    }
    .rename-btn {
      color: var(--warning-color);
    }
    .rename-btn:hover {
      background-color: rgba(90, 98, 104, 0.1);
    }
    .navbar {
      background: linear-gradient(
              90deg,
              var(--primary-color),
              var(--secondary-color)
      );
      padding: 15px 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .navbar-brand {
      color: white;
      font-weight: 700;
      font-size: 1.5rem;
    }

    .user-info {
      color: white;
      display: flex;
      align-items: center;
    }

    .avatar {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-weight: bold;
      color: var(--primary-color);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .logout-btn {
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 50px;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .main-container {
      margin-top: 30px;
    }

    .card {
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border: none;
      overflow: hidden;
      margin-bottom: 25px;
      transition: all 0.3s;
    }

    .card-header {
      background: linear-gradient(
              45deg,
              rgba(52, 58, 64, 0.8),
              rgba(33, 37, 41, 0.8)
      );
      color: white;
      font-weight: bold;
      border: none;
      padding: 15px 20px;
    }

    .card-body {
      padding: 25px;
    }

    .file-upload-area {
      border: 2px dashed rgba(52, 58, 64, 0.3);
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      position: relative;
    }

    .file-upload-area:hover {
      border-color: var(--primary-color);
      background-color: rgba(52, 58, 64, 0.05);
    }

    .file-upload-icon {
      font-size: 3rem;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .file-input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .upload-btn {
      background: linear-gradient(
              45deg,
              var(--primary-color),
              var(--secondary-color)
      );
      border: none;
      padding: 12px 25px;
      border-radius: 50px;
      color: white !important;
      font-weight: 600;
      margin-top: 20px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(52, 58, 64, 0.3);
    }

    .progress {
      height: 10px;
      border-radius: 10px;
      margin-top: 15px;
      background-color: rgba(0, 0, 0, 0.05);
    }

    .progress-bar {
      background: linear-gradient(
              45deg,
              var(--primary-color),
              var(--secondary-color)
      );
      border-radius: 10px;
    }

    .search-bar {
      display: flex;
      margin-bottom: 20px;
    }

    .search-input {
      flex-grow: 1;
      border-radius: 50px 0 0 50px;
      border: 1px solid #dee2e6;
      padding: 12px 20px;
      font-size: 1rem;
      transition: all 0.3s;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
    }

    .search-input:focus {
      box-shadow: 0 2px 15px rgba(52, 58, 64, 0.1);
      border-color: var(--primary-color);
    }

    .sort-select {
      border-radius: 0 50px 50px 0;
      border: 1px solid #dee2e6;
      border-left: none;
      padding: 0 20px;
      font-size: 0.9rem;
      background-color: white;
      transition: all 0.3s;
    }

    .sort-select:focus {
      box-shadow: 0 2px 15px rgba(52, 58, 64, 0.1);
    }

    .files-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .file-item {
      background-color: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      border-left: 4px solid var(--primary-color);
    }

    .file-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(
              45deg,
              var(--primary-color),
              var(--secondary-color)
      );
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: white;
      font-size: 1.2rem;
    }

    .file-info {
      flex-grow: 1;
    }

    .file-name {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 5px;
      color: var(--dark-color);
    }

    .file-date {
      font-size: 0.8rem;
      color: #666;
    }

    .file-actions {
      display: flex;
      align-items: center;
    }

    .action-btn {
      background-color: transparent;
      border: none;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
      margin-left: 5px;
      color: #555;
    }

    .download-btn {
      color: var(--info-color);
    }

    .download-btn:hover {
      background-color: rgba(73, 80, 87, 0.1);
    }

    .delete-btn {
      color: var(--danger-color);
    }

    .delete-btn:hover {
      background-color: rgba(108, 117, 125, 0.1);
    }

    .share-btn {
      color: var(--danger-color);
    }

    .share-btn:hover {
      background-color: rgba(108, 117, 125, 0.1);
    }

    .copy-btn {
      color: var(--warning-color);
    }

    .copy-btn:hover {
      background-color: rgba(90, 98, 104, 0.1);
    }

    .preview-container {
      margin-top: 10px;
      display: none;
      animation: fadeIn 0.3s;
    }

    .preview-img {
      max-height: 150px;
      width: auto;
      border-radius: 5px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .preview-img:hover {
      transform: scale(1.05);
    }

    .zoom-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ */
      max-width: 100%;
      max-height: 70vh;
      border: 1px solid #ccc;
      border-radius: 4px;
      touch-action: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –∂–µ—Å—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      cursor: grab;
    }

    .zoomable-img {
      transition: transform 0.2s ease-in-out;
      transform-origin: 0 0; /* –ß—Ç–æ–±—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ —É–≥–ª–∞ */
      user-select: none;
      -webkit-user-drag: none;
    }

    .zoom-controls {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    .zoom-btn {
      padding: 5px 10px;
      font-size: 16px;
      line-height: 1;
    }

    .alert {
      border-radius: 10px;
      padding: 15px 20px;
      margin-bottom: 20px;
      animation: fadeIn 0.5s;
    }

    .alert-success {
      background-color: rgba(90, 98, 104, 0.1);
      border-left: 4px solid var(--success-color);
      color: var(--success-color);
    }

    .alert-danger {
      background-color: rgba(108, 117, 125, 0.1);
      border-left: 4px solid var(--danger-color);
      color: var(--danger-color);
    }

    .alert-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .file-name-display {
      font-size: 0.9rem;
      margin-top: 10px;
      font-weight: 500;
      color: #555;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .no-files-message {
      text-align: center;
      padding: 30px;
      color: #777;
      font-style: italic;
      background-color: rgba(0, 0, 0, 0.02);
      border-radius: 10px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .file-type-image {
      position: relative;
    }

    .image-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
    }

    .image-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è PDF-–æ–≤–µ—Ä–ª–µ—è */
    .pdf-viewer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .nav-button {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .nav-button:hover {
      background-color: rgba(0, 0, 0, 0.7);
    }

    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .overlay-content {
      max-width: 90%;
      max-height: 90%;
      position: relative;
    }

    .overlay-img {
      max-width: 100%;
      max-height: 90vh;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }

    .close-overlay {
      position: absolute;
      top: -40px;
      right: 0;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      background: transparent;
      border: none;
    }

    .file-size {
      font-size: 0.8rem;
      color: #666;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
    .dark-mode {
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --text-color: #f8f9fa;
      --muted-text: #aaa;
      --border-color: #333;
      --input-bg: #1e1e1e;
      --input-text: #f8f9fa;
      --icon-color: #ccc;
    }

    .dark-mode {
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    .dark-mode .card {
      background-color: var(--card-bg);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .dark-mode .file-item {
      background-color: var(--card-bg);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }

    .dark-mode .search-input,
    .dark-mode .sort-select {
      background-color: var(--input-bg);
      color: var(--input-text);
      border-color: var(--border-color);
    }

    .dark-mode .file-name {
      color: var(--text-color);
    }

    .dark-mode .file-date {
      color: var(--muted-text);
    }

    .dark-mode .action-btn {
      color: var(--icon-color);
    }

    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1050;
    }

    .toast {
      background: white;
      border-radius: 10px;
      padding: 15px 20px;
      margin-bottom: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      animation: slideIn 0.3s forwards;
      max-width: 350px;
      opacity: 0;
      transform: translateX(50px);
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast-icon {
      margin-right: 15px;
      font-size: 1.5rem;
    }

    .toast-success .toast-icon {
      color: var(--success-color);
    }

    .toast-error .toast-icon {
      color: var(--danger-color);
    }

    .toast-info .toast-icon {
      color: var(--info-color);
    }

    .toast-body {
      flex-grow: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .toast-message {
      color: #666;
      font-size: 0.9rem;
    }

    .selected-file-info {
      display: none;
      margin-top: 15px;
      padding: 10px;
      background: rgba(52, 58, 64, 0.05);
      border-radius: 10px;
      animation: fadeIn 0.3s;
    }
  </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-dark">
  <div class="container">
    <a class="navbar-brand" href="#">
      <i class="fas fa-exchange-alt me-2"></i>–û–±–º–µ–Ω–Ω–∏–∫ —Ñ–∞–π–ª–æ–≤
    </a>
    <div class="user-info">
      <div class="avatar">
        <span id="user-avatar"></span>
      </div>
      <div class="me-3">
        <div id="user-login" class="fw-bold"></div>
        <small>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</small>
      </div>
      <button onclick="logout()" class="logout-btn">
        <i class="fas fa-sign-out-alt me-2"></i>–í—ã–π—Ç–∏
      </button>
    </div>
  </div>
</nav>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container main-container">
  <div class="row">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div class="col-lg-4 mb-4 sticky-wrapper">
      <div class="card h-100">
        <div class="card-header">
          <i class="fas fa-cloud-upload-alt me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        </div>
        <div class="card-body">
          <div class="file-upload-area" id="dropArea">
            <div class="file-upload-icon">
              <i class="fas fa-file-upload"></i>
            </div>
            <h5>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h5>
            <p class="text-muted">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100 –ú–ë</p>
            <input type="file" id="file-input" class="file-input" />
            <input type="hidden" id="user-uuid" />
            <div id="selected-file-info" class="selected-file-info">
              <div class="d-flex align-items-center">
                <i class="fas fa-file me-2 text-primary"></i>
                <div class="file-name-display" id="selected-file-name">
                  –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω
                </div>
              </div>
            </div>
          </div>
          <button onclick="uploadFile()" class="btn upload-btn w-100">
            <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
          </button>

          <div id="progress-container" class="mt-3" style="display: none">
            <div class="d-flex justify-content-between mb-1">
              <small>–ó–∞–≥—Ä—É–∑–∫–∞...</small>
              <small id="progress-text">0%</small>
            </div>
            <div class="progress">
              <div
                      id="progress-bar"
                      class="progress-bar"
                      role="progressbar"
                      style="width: 0%"
              ></div>
            </div>
          </div>

          <div id="upload-result" class="mt-3"></div>
        </div>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ñ–∞–π–ª–æ–≤ -->
    <div class="col-lg-8">
      <div class="card">
        <div
                class="card-header d-flex justify-content-between align-items-center"
        >
          <div><i class="fas fa-folder-open me-2"></i>–í–∞—à–∏ —Ñ–∞–π–ª—ã</div>
          <div class="form-check form-switch">
            <input
                    class="form-check-input"
                    type="checkbox"
                    id="theme-toggle"
            />
            <label class="form-check-label text-white" for="theme-toggle"
            >–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label
            >
          </div>
        </div>
        <div class="card-body">
          <!-- –ü–æ–∏—Å–∫ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
          <div class="search-bar">
            <input
                    type="text"
                    id="search-input"
                    class="form-control search-input"
                    placeholder="–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤..."
                    oninput="filterFiles()"
            />
            <select
                    id="sort-select"
                    class="form-select sort-select"
                    onchange="applySortAndFilter()"
            >
              <option value="name">–ü–æ –∏–º–µ–Ω–∏</option>
              <option value="date">–ü–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)</option>
              <option value="size_asc">–ü–æ —Ä–∞–∑–º–µ—Ä—É (–í–æ—Ä–∑–∞—Å—Ç–∞–Ω–∏–µ)</option>
              <option value="size_desc">–ü–æ —Ä–∞–∑–º–µ—Ä—É (–£–±—ã–≤–∞–Ω–∏–µ)</option>
            </select>
          </div>

          <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
          <div id="files-container">
            <ul id="files-list" class="files-list"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay –¥–ª—è –ø–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div class="image-overlay" id="image-overlay">
  <div class="overlay-content">
    <button class="close-overlay" onclick="closeImageOverlay()">
      <i class="fas fa-times"></i>
    </button>
    <img
            class="overlay-img"
            id="overlay-img"
            src=""
            alt="–ü–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
    />
  </div>
</div>
<!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è PDF -->
<div class="image-overlay" id="pdfOverlay">
  <div class="overlay-content">
    <button class="close-overlay" onclick="closePdfOverlay()">
      <i class="fas fa-times"></i>
    </button>
    <div class="d-flex align-items-center justify-content-center flex-wrap gap-3">
      <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
      <button class="nav-button prev" id="prevPdfPage" disabled>
        <i class="fas fa-chevron-left"></i>
      </button>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
      <div class="zoom-container">
        <img id="pdfPageImage" src="" alt="PDF Page" class="img-fluid zoomable-img" style="max-height: 70vh;">
      </div>

      <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã PDF -->
      <div class="text-center">
        <img id="pdfPageImage" src="" alt="PDF Page" class="img-fluid" style="max-height: 70vh; border: 1px solid #ccc;">
        <div class="mt-2">
          <span id="pdfCurrentPage">1</span> / <span id="pdfTotalPages">1</span>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥" -->
      <button class="nav-button next" id="nextPdfPage" disabled>
        <i class="fas fa-chevron-right"></i>
      </button>
      <!-- –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <div class="zoom-controls">
        <button class="btn btn-sm btn-light zoom-btn" onclick="zoomPdfImage(0.1)">+</button>
        <button class="btn btn-sm btn-light zoom-btn" onclick="zoomPdfImage(-0.1)">‚àí</button>
        <button class="btn btn-sm btn-light zoom-btn" onclick="resetPdfZoom()">üîÑ</button>
      </div>
    </div>
    </div>
  </div>
</div>
<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="toast-container" id="toast-container"></div>

<!-- Bootstrap JS —Å Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript -->
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userLogin = localStorage.getItem("userLogin");
  const userUuid = localStorage.getItem("userUuid");

  if (!userLogin || !userUuid) {
    showToast("–û—à–∏–±–∫–∞", "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã", "error");
    setTimeout(() => {
      window.location.href = "/";
    }, 2000);
    throw new Error("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage");
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  document.getElementById("user-login").innerText = userLogin;
  document.getElementById("user-uuid").value = userUuid;
  document.getElementById("user-avatar").innerText = userLogin
          .charAt(0)
          .toUpperCase();

  // –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
  const themeToggle = document.getElementById("theme-toggle");
  themeToggle.addEventListener("change", function () {
    document.body.classList.toggle("dark-mode", this.checked);
    localStorage.setItem("darkMode", this.checked);
  });

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
  if (localStorage.getItem("darkMode") === "true") {
    themeToggle.checked = true;
    document.body.classList.add("dark-mode");
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Drag & Drop
  const dropArea = document.getElementById("dropArea");
  const fileInput = document.getElementById("file-input");
  const selectedFileInfo = document.getElementById("selected-file-info");
  const selectedFileName = document.getElementById("selected-file-name");

  // –°–æ–±—ã—Ç–∏—è –¥–ª—è Drag & Drop
  ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    dropArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ["dragenter", "dragover"].forEach((eventName) => {
    dropArea.addEventListener(eventName, highlight, false);
  });

  ["dragleave", "drop"].forEach((eventName) => {
    dropArea.addEventListener(eventName, unhighlight, false);
  });

  function highlight() {
    dropArea.classList.add("bg-light");
  }

  function unhighlight() {
    dropArea.classList.remove("bg-light");
  }

  dropArea.addEventListener("drop", handleDrop, false);

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    fileInput.files = files;
    updateFileInfo();
  }

  fileInput.addEventListener("change", updateFileInfo);

  function updateFileInfo() {
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      selectedFileName.textContent = file.name;
      selectedFileInfo.style.display = "block";

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
      const fileType = file.type.split("/")[0];
      let iconClass = "fa-file";

      if (fileType === "image") {
        iconClass = "fa-file-image";
      } else if (fileType === "video") {
        iconClass = "fa-file-video";
      } else if (fileType === "audio") {
        iconClass = "fa-file-audio";
      } else if (file.name.match(/\.(pdf)$/i)) {
        iconClass = "fa-file-pdf";
      } else if (file.name.match(/\.(doc|docx)$/i)) {
        iconClass = "fa-file-word";
      } else if (file.name.match(/\.(xls|xlsx)$/i)) {
        iconClass = "fa-file-excel";
      } else if (file.name.match(/\.(zip|rar|7z|tar|gz)$/i)) {
        iconClass = "fa-file-archive";
      }

      document.querySelector(
              "#selected-file-info i"
      ).className = `fas ${iconClass} me-2 text-primary`;
    } else {
      selectedFileInfo.style.display = "none";
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
  async function uploadFile() {
    const fileInput = document.getElementById("file-input");
    const uuid = document.getElementById("user-uuid").value;
    const resultDiv = document.getElementById("upload-result");
    const progressBar = document.getElementById("progress-bar");
    const progressText = document.getElementById("progress-text");
    const progressContainer = document.getElementById("progress-container");

    const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100 MB

    if (!fileInput.files.length) {
      showToast("–û—à–∏–±–∫–∞", "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏", "error");
      return;
    }

    const file = fileInput.files[0];
    if (file.size > MAX_FILE_SIZE) {
      resultDiv.innerHTML = `
                <div class="alert alert-danger">
                  <div class="alert-title"><i class="fas fa-exclamation-circle me-2"></i>–û—à–∏–±–∫–∞</div>
                  <div>–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100 –ú–ë</div>
                </div>
              `;
      showToast("–û—à–∏–±–∫–∞", "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π", "error");
      return;
    }

    const formData = new FormData();
    formData.append("file", file);
    formData.append("userUuid", uuid);

    resultDiv.innerHTML = "";
    progressContainer.style.display = "block";
    progressBar.style.width = "0%";
    progressText.textContent = "0%";

    const xhr = new XMLHttpRequest();

    xhr.upload.onprogress = function (event) {
      if (event.lengthComputable) {
        const percentComplete = Math.round(
                (event.loaded / event.total) * 100
        );
        progressBar.style.width = percentComplete + "%";
        progressText.textContent = percentComplete + "%";
      }
    };

    xhr.onload = function () {
      progressContainer.style.display = "none";
      if (xhr.status === 200) {
        try {
          const response = JSON.parse(xhr.responseText);
          resultDiv.innerHTML = `
                    <div class="alert alert-success">
                      <div class="alert-title"><i class="fas fa-check-circle me-2"></i>–£—Å–ø–µ—à–Ω–æ</div>
                      <div>${response.message}</div>
                    </div>
                  `;
          showToast("–£—Å–ø–µ—à–Ω–æ", "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω", "success");
          loadUserFiles();
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
          fileInput.value = "";
          selectedFileInfo.style.display = "none";
        } catch (e) {
          resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                      <div class="alert-title"><i class="fas fa-exclamation-circle me-2"></i>–û—à–∏–±–∫–∞</div>
                      <div>–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞</div>
                    </div>
                  `;
          showToast("–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞", "error");
        }
      } else {
        resultDiv.innerHTML = `
                  <div class="alert alert-danger">
                    <div class="alert-title"><i class="fas fa-exclamation-circle me-2"></i>–û—à–∏–±–∫–∞</div>
                    <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${xhr.statusText}</div>
                  </div>
                `;
        showToast("–û—à–∏–±–∫–∞", `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${xhr.statusText}`, "error");
      }
    };

    xhr.onerror = function () {
      progressContainer.style.display = "none";
      resultDiv.innerHTML = `
    <div class="alert alert-danger">
      <div class="alert-title"><i class="fas fa-exclamation-circle me-2"></i>–û—à–∏–±–∫–∞</div>
      <div>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: ${xhr.statusText}</div>
    </div>
  `;
      showToast(
              "–û—à–∏–±–∫–∞",
              `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: ${xhr.statusText}`,
              "error"
      );
    };

    xhr.open("POST", "/upload", true);
    xhr.send(formData);
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫—É
  function togglePreview(uuid) {
    const file = allFiles.find((f) => f.uuid === uuid);
    if (!file) return;

    const originalName = file.fileName || file.file_name;
    const ext = originalName.split(".").pop().toLowerCase();

    const imageExtensions = ["jpg", "jpeg", "png", "gif"];
    if (!imageExtensions.includes(ext)) {
      showToast("–ò–Ω—Ñ–æ", "–ü—Ä–µ–≤—å—é –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π", "info");
      return;
    }

    const container = document.getElementById(`preview-${uuid}`);
    if (!container) return;

    // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
    if (container.style.display === "none") {
      container.style.display = "block"; // –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
    } else {
      container.style.display = "none"; // –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
  let allFiles = [];

  async function loadUserFiles() {
    const resultDiv = document.getElementById("upload-result");
    resultDiv.innerHTML = "";

    const response = await fetch("/usersFiles", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ login: userLogin }),
    });

    if (!response.ok) {
      showToast("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤", "error");
      return;
    }

    const files = await response.json();

    if (!Array.isArray(files)) {
      document.getElementById("files-list").innerHTML =
              '<li class="file-item"><div class="no-files-message">–§–∞–π–ª–æ–≤ –Ω–µ—Ç</div></li>';
      return;
    }

    allFiles = [...files];
    applySortAndFilter();
  }

  function applySortAndFilter() {
    const query = document
            .getElementById("search-input")
            .value.toLowerCase()
            .trim();
    const sortType = document.getElementById("sort-select").value;

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    let filtered = allFiles.filter((file) =>
            (file.fileName || file.file_name).toLowerCase().includes(query)
    );

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    switch (sortType) {
      case "name":
        filtered.sort((a, b) => {
          const nameA = (a.fileName || a.file_name).toUpperCase();
          const nameB = (b.fileName || b.file_name).toUpperCase();
          return nameA.localeCompare(nameB);
        });
        break;
      case "date":
        filtered.sort(
                (a, b) => new Date(b.CreatedAt) - new Date(a.CreatedAt)
        );
        break;
      case "size_asc":
        filtered.sort((a, b) => (a.size || 0) - (b.size || 0));
        break;
      case "size_desc":
        filtered.sort((a, b) => (b.size || 0) - (a.size || 0));
        break;
    }

    displayFiles(filtered);
  }

  function displayFiles(files) {
    const list = document.getElementById("files-list");
    list.innerHTML = "";

    if (files.length === 0) {
      list.innerHTML =
              '<li class="file-item"><div class="no-files-message">–§–∞–π–ª–æ–≤ –Ω–µ—Ç</div></li>';
      return;
    }

    for (const file of files) {
      const li = createFileItem(file);
      list.appendChild(li);
    }
  }

  function createFileItem(file) {
    const li = document.createElement("li");
    li.className = "file-item";
    const downloadLink = `/download/${file.uuid}`;
    const originalName = file.fileName || file.file_name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –¥–ª—è –∏–∫–æ–Ω–∫–∏
    const ext = originalName.split(".").pop().toLowerCase();
    let iconClass = "fa-file";

    const isPdf = ext === "pdf";
    const previewBtn = isPdf ? `
  <button class="action-btn preview-btn" onclick="event.stopPropagation(); openPdfOverlay('${file.uuid}')">
    <i class="fas fa-book-open"></i>
  </button>
` : '';
    if (["jpg", "jpeg", "png", "gif"].includes(ext)) {
      iconClass = "fa-file-image";
    } else if (ext === "pdf") {
      iconClass = "fa-file-pdf";
    } else if (["doc", "docx"].includes(ext)) {
      iconClass = "fa-file-word";
    } else if (["xls", "xlsx"].includes(ext)) {
      iconClass = "fa-file-excel";
    } else if (["zip", "rar", "7z", "tar", "gz"].includes(ext)) {
      iconClass = "fa-file-archive";
    } else if (["txt", "log", "csv"].includes(ext)) {
      iconClass = "fa-file-alt";
    } else if (["mp4", "avi", "mkv"].includes(ext)) {
      iconClass = "fa-file-video";
    } else if (["mp3", "wav", "ogg"].includes(ext)) {
      iconClass = "fa-file-audio";
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
    const fileSize = file.size ? formatSize(file.size) : "‚Äî";

    // HTML —ç–ª–µ–º–µ–Ω—Ç–∞ —Ñ–∞–π–ª–∞
    li.innerHTML = `
  <div class="d-flex align-items-center" onclick="togglePreview('${
            file.uuid
    }')">
    <div class="file-icon">
      <i class="fas ${iconClass}"></i>
    </div>
    <div class="file-info flex-grow-1">
      <div class="file-name">${originalName}</div>
      <div class="file-date">
        –ó–∞–≥—Ä—É–∑–∫–∞: ${new Date(
            file.CreatedAt || file.created_at
    ).toLocaleDateString()}
      </div>
      <div class="file-size text-muted">
        –†–∞–∑–º–µ—Ä: ${fileSize}
      </div>
    </div>
    <div class="file-actions d-flex">
      <button class="action-btn download-btn" onclick="event.stopPropagation(); forceDownload('${
            file.uuid
    }', '${originalName}')">
        <i class="fas fa-download"></i>
      </button>
      <button class="action-btn delete-btn" onclick="event.stopPropagation(); deleteFile('${
            file.uuid
    }')">
        <i class="fas fa-trash"></i>
      </button>
      <button class="action-btn rename-btn" onclick="event.stopPropagation(); updateFileName('${
            file.uuid
    }')">
        <i class="fas fa-edit"></i>
      </button>
      <button class="action-btn share-btn" onclick="event.stopPropagation(); shareFile('${
            file.uuid
    }', '${originalName}')">
        <i class="fas fa-share-alt"></i>
      </button>
      ${previewBtn}
    </div>
  </div>
  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é -->
  <div id="preview-${file.uuid}" class="preview-container">
    <img src="/download/${
            file.uuid
    }" alt="–ü—Ä–µ–≤—å—é" class="preview-img img-fluid" onclick="openImageOverlay('/download/${
            file.uuid
    }')">
  </div>
`;

    return li;
  }
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1024 ‚Üí "1.00 –ö–ë")
  function formatSize(bytes) {
    const sizes = ["–ë", "–ö–ë", "–ú–ë", "–ì–ë"];
    if (bytes === 0) return "0 –ë";
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return (
            parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + " " + sizes[i]
    );
  }

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
  function forceDownload(uuid, fileName) {
    const link = document.createElement("a");
    link.href = `/download/${uuid}`;
    link.download = fileName; // –ó–¥–µ—Å—å –º—ã –∑–∞–¥–∞–µ–º –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –±—Ä–∞—É–∑–µ—Ä —Å–æ—Ö—Ä–∞–Ω–∏—Ç
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // –ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–π–ª–∞–º
  function filterFiles() {
    applySortAndFilter();
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
  async function deleteFile(uuid) {
    const confirmDelete = confirm(
            "–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?"
    );
    if (!confirmDelete) return;

    const response = await fetch(`/delete-file/${uuid}`, {
      method: "DELETE",
    });

    if (response.ok) {
      showToast("–£—Å–ø–µ—Ö", "–§–∞–π–ª —É–¥–∞–ª–µ–Ω", "success");
      loadUserFiles(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
    } else {
      showToast("–û—à–∏–±–∫–∞", "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª", "error");
    }
  }

  async function updateFileName(uuid) {
    const newName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è):");
    if (!newName || newName.trim() === "") {
      showToast("–û—à–∏–±–∫–∞", "–ò–º—è —Ñ–∞–π–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º", "error");
      return;
    }

    const response = await fetch(`/updateFileName/${uuid}`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ file_name: newName }),
    });

    if (response.ok) {
      showToast("–£—Å–ø–µ—Ö", "–ò–º—è —Ñ–∞–π–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–æ", "success");
      loadUserFiles(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
    } else {
      const error = await response.text();
      showToast(
              "–û—à–∏–±–∫–∞",
              `–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞: ${error}`,
              "error"
      );
    }
  }

  async function shareFile(uuid, fileName) {
    const downloadLink = `${window.location.origin}/download/${uuid}`;
    const title = `–§–∞–π–ª: ${fileName}`;

    // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Web Share API
    if (navigator.share) {
      try {
        await navigator.share({
          title: title,
          text: `–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª "${fileName}"`,
          url: downloadLink,
        });
        showToast("–£—Å–ø–µ—Ö", "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–µ–ª—ë–Ω", "success");
      } catch (error) {
        console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ Web Share API:", error);
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –¥–µ–ª–µ–Ω–∏–µ
        copyToClipboard(downloadLink, fileName);
      }
    } else {
      // –ï—Å–ª–∏ Web Share –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä
      copyToClipboard(downloadLink, fileName);
    }
  }
  async function copyToClipboard(text, fileName) {
    try {
      await navigator.clipboard.writeText(text);
      showToast("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞", `"${fileName}"`, "info");
    } catch (err) {
      console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ", err);
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.");
    }
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–π –∫–æ–ø–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  function openImageOverlay(src) {
    const overlay = document.getElementById("image-overlay");
    const img = document.getElementById("overlay-img");

    img.src = src;
    overlay.classList.add("active");
  }

  function closeImageOverlay() {
    const overlay = document.getElementById("image-overlay");
    const img = document.getElementById("overlay-img");

    overlay.classList.remove("active");
    img.src = "";
  }

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PDF
  let currentPdfUuid = null;
  let currentPdfPage = 1;
  let totalPdfPages = 1;

  // –û—Ç–∫—Ä—ã—Ç–∏–µ PDF-–æ–≤–µ—Ä–ª–µ—è
  function openPdfOverlay(uuid) {
    currentPdfUuid = uuid;
    currentPdfPage = 1;
    totalPdfPages = 1;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadPdfPage(currentPdfPage);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    const overlay = document.getElementById('pdfOverlay');
    overlay.classList.add('active');
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ PDF-–æ–≤–µ—Ä–ª–µ—è
  function closePdfOverlay() {
    const overlay = document.getElementById('pdfOverlay');
    overlay.classList.remove('active');

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –º–∞—Å—à—Ç–∞–± –∏ –ø–æ–∑–∏—Ü–∏—é
    const img = document.getElementById('pdfPageImage');
    img.src = '';
    img.style.transform = 'scale(1)';
    pdfZoomLevel = 1;
    translateX = 0;
    translateY = 0;

    currentPdfUuid = null;
  }

  let pdfZoomLevel = 1;
  const maxZoom = 2.5;
  const minZoom = 0.5;

  // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  function zoomPdfImage(delta) {
    pdfZoomLevel += delta;
    if (pdfZoomLevel < minZoom) pdfZoomLevel = minZoom;
    if (pdfZoomLevel > maxZoom) pdfZoomLevel = maxZoom;

    const img = document.getElementById('pdfPageImage');
    img.style.transform = `scale(${pdfZoomLevel})`;
  }

  // –°–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞
  function resetPdfZoom() {
    pdfZoomLevel = 1;
    translateX = 0;
    translateY = 0;
    updateImageTransform();
  }

  function updateImageTransform() {
    const img = document.getElementById('pdfPageImage');
    img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${pdfZoomLevel})`;
  }

  let isDragging = false;
  let startX = 0;
  let startY = 0;
  let translateX = 0;
  let translateY = 0;

  // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
  function startDrag(e) {
    isDragging = true;
    startX = e.clientX || e.touches?.[0].clientX;
    startY = e.clientY || e.touches?.[0].clientY;
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('mouseleave', endDrag);
    document.addEventListener('touchmove', onDrag, { passive: false });
    document.addEventListener('touchend', endDrag);
  }

  // –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
  function onDrag(e) {
    if (!isDragging) return;

    e.preventDefault();

    const clientX = e.clientX || e.touches?.[0].clientX;
    const clientY = e.clientY || e.touches?.[0].clientY;

    const dx = clientX - startX;
    const dy = clientY - startY;

    const img = document.getElementById('pdfPageImage');
    const container = img.parentElement;

    const imgWidth = img.offsetWidth * pdfZoomLevel;
    const imgHeight = img.offsetHeight * pdfZoomLevel;

    const containerWidth = container.offsetWidth;
    const containerHeight = container.offsetHeight;

    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
    if (translateX + dx > 0 && imgWidth <= containerWidth) {
      translateX = 0;
    } else if (translateX + dx + imgWidth < containerWidth) {
      translateX = containerWidth - imgWidth;
    } else {
      translateX += dx;
    }

    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
    if (translateY + dy > 0 && imgHeight <= containerHeight) {
      translateY = 0;
    } else if (translateY + dy + imgHeight < containerHeight) {
      translateY = containerHeight - imgHeight;
    } else {
      translateY += dy;
    }

    startX = clientX;
    startY = clientY;

    img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${pdfZoomLevel})`;
  }

  // –ö–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
  function endDrag() {
    isDragging = false;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('mouseleave', endDrag);
    document.removeEventListener('touchmove', onDrag);
    document.removeEventListener('touchend', endDrag);
  }

  // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
  document.getElementById('pdfPageImage')?.addEventListener('mousedown', startDrag);
  document.getElementById('pdfPageImage')?.addEventListener('touchstart', startDrag, { passive: false });

  // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  document.getElementById('pdfPageImage').addEventListener('wheel', function(e) {
    e.preventDefault();
    if (e.deltaY < 0) {
      zoomPdfImage(0.1);
    } else {
      zoomPdfImage(-0.1);
    }
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã PDF
  function loadPdfPage(pageNumber) {
    if (!currentPdfUuid) return;

    fetch(`/api/pdf/${currentPdfUuid}/page/${pageNumber}`)
            .then(response => response.json())
            .then(data => {
              document.getElementById('pdfPageImage').src = data.image;
              document.getElementById('pdfCurrentPage').textContent = data.page;
              document.getElementById('pdfTotalPages').textContent = data.totalPages;

              currentPdfPage = data.page;
              totalPdfPages = data.totalPages;

              resetPdfZoom();

              updatePdfNavButtons();
            })
            .catch(error => {
              console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
              showToast('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É PDF', 'error');
            });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  function updatePdfNavButtons() {
    document.getElementById('prevPdfPage').disabled = currentPdfPage <= 1;
    document.getElementById('nextPdfPage').disabled = currentPdfPage >= totalPdfPages;
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  document.getElementById('prevPdfPage').addEventListener('click', () => {
    if (currentPdfPage > 1) {
      loadPdfPage(currentPdfPage - 1);
    }
  });

  document.getElementById('nextPdfPage').addEventListener('click', () => {
    if (currentPdfPage < totalPdfPages) {
      loadPdfPage(currentPdfPage + 1);
    }
  });

  // –ü–æ–∫–∞–∑ Toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function showToast(title, message, type) {
    const container = document.getElementById("toast-container");
    const toast = document.createElement("div");
    toast.className = `toast animate__animated animate__fadeInUp animate__faster ${
            type === "success"
                    ? "toast-success"
                    : type === "error"
                            ? "toast-error"
                            : "toast-info"
    } mb-3`;

    toast.innerHTML = `
        <div class="toast-icon">
          <i class="fas ${
            type === "success" ? "fa-check-circle" : "fa-exclamation-circle"
    }"></i>
        </div>
        <div class="toast-body">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
      `;

    container.appendChild(toast);

    setTimeout(() => {
      toast.classList.add("animate__fadeOutDown");
    }, 2500);

    setTimeout(() => {
      container.removeChild(toast);
    }, 3000);
  }

  // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
  //const REFRESH_INTERVAL = 5000; // 5 —Å–µ–∫—É–Ω–¥
  document.addEventListener("DOMContentLoaded", () => {
    loadUserFiles(); // –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    setInterval(loadUserFiles, REFRESH_INTERVAL); // –¥–∞–ª–µ–µ –ø–æ —Ç–∞–π–º–µ—Ä—É
  });

  // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
  function logout() {
    localStorage.removeItem("userLogin");
    localStorage.removeItem("userUuid");
    window.location.href = "/";
  }
</script>
</body>
</html>